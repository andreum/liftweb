<?xml version="1.0"?>
<!DOCTYPE Configure PUBLIC "-//Mort Bay Consulting//DTD Configure//EN" "http://jetty.mortbay.org/configure.dtd">
<Configure class="org.mortbay.jetty.webapp.WebAppContext">
  <!-- Add user transactions -->
  <New id="tx" class="org.mortbay.jetty.plus.naming.Transaction">
    <Arg>
      <New class="com.atomikos.icatch.jta.UserTransactionImp"/>
    </Arg>
  </New>

  <!-- set up the database -->
  <New id="myds" class="org.mortbay.jetty.plus.naming.Resource">
    <Arg>jdbc/jpaDS</Arg>
    <!-- 
    <Arg>
      <New class="com.atomikos.jdbc.nonxa.NonXADataSourceBean">
        <Set name="Url">jdbc:derby:lift_example;create=true</Set>
        <Set name="driverClassName">org.apache.derby.jdbc.EmbeddedDriver</Set>
      </New>
    </Arg>
    -->
    <Arg>
      <New class="com.atomikos.jdbc.SimpleDataSourceBean">
	<Set name="xaDataSourceClassName">org.apache.derby.jdbc.EmbeddedXADataSource</Set>
	<Set name="xaDataSourceProperties">databaseName=lift_example;createDatabase=create</Set>
	<Set name="uniqueResourceName">jpaDS</Set>
      </New>
    </Arg>
  </New>

  <!-- Bind the persistence module factory first -->
  <Call id="jpawebEMF" class="javax.persistence.Persistence" name="createEntityManagerFactory">
    <Arg>jpaweb</Arg>
  </Call>

  <!-- And now the EM -->  
  <New id="jpawebEM" class="org.mortbay.jetty.plus.naming.EnvEntry">
    <Arg>persistence/jpaweb</Arg>
    <Arg>
      <Ref id="jpawebEMF">
	<Call name="createEntityManager" />
      </Ref>
    </Arg>
  </New>

</Configure>
